<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êòü„Å∏„ÅÆÊóÖ - „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Çπ„Éà„Éº„É™„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2d3142;
            --secondary-color: #4f5d75;
            --accent-color: #5c9ead;
            --text-color: #ffffff;
            --highlight-color: #e3b23c;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--primary-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            transition: background-color 2s ease;
        }

        #story-container {
            width: 90%;
            max-width: 800px;
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }

        #title-screen {
            text-align: center;
        }

        #title-screen h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(92, 158, 173, 0.7);
            opacity: 0;
            transform: translateY(-20px);
        }

        #title-screen p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0;
            transform: translateY(20px);
        }

        #start-button {
            padding: 0.8rem 2rem;
            font-size: 1.2rem;
            background-color: var(--accent-color);
            color: var(--text-color);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
        }

        #start-button:hover {
            background-color: var(--highlight-color);
            transform: scale(1.05);
        }

        #story {
            display: none;
        }

        #story-text {
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            opacity: 0;
        }

        #choices {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            opacity: 0;
        }

        .choice-button {
            padding: 1rem;
            font-size: 1rem;
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .choice-button:hover {
            background-color: var(--accent-color);
            transform: translateX(10px);
        }

        #restart-button {
            margin-top: 2rem;
            padding: 0.5rem 1rem;
            background-color: var(--highlight-color);
            color: var(--primary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            opacity: 0;
            display: none;
        }

        #restart-button:hover {
            background-color: #ccac62;
        }

        #background-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
        }

        .achievement {
            position: fixed;
            bottom: 20px;
            right: -300px;
            background-color: var(--highlight-color);
            color: var(--primary-color);
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 10;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        #progress-bar {
            position: fixed;
            top: 10px;
            left: 10px;
            width: 200px;
            height: 10px;
            background-color: var(--secondary-color);
            border-radius: 5px;
            overflow: hidden;
            opacity: 0;
        }

        #progress {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            transition: width 0.5s ease;
        }

        #share-button {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: var(--accent-color);
            color: var(--text-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            opacity: 0;
            z-index: 5;
        }

        #sound-toggle {
            position: fixed;
            bottom: 10px;
            left: 10px;
            padding: 5px 10px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 5;
            opacity: 0;
        }

        @media (max-width: 768px) {
            #title-screen h1 {
                font-size: 2.5rem;
            }

            #story-text {
                font-size: 1.1rem;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
</head>
<body>
    <div id="background-elements"></div>
    
    <div id="progress-bar">
        <div id="progress"></div>
    </div>
    
    <button id="share-button">„Ç∑„Çß„Ç¢</button>
    <button id="sound-toggle">üîä</button>
    
    <div id="story-container">
        <div id="title-screen">
            <h1>Êòü„Å∏„ÅÆÊóÖ</h1>
            <p>„ÅÇ„Å™„Åü„ÅÆÈÅ∏Êäû„Åå„ÄÅÁâ©Ë™û„ÇíÂãï„Åã„Åô</p>
            <button id="start-button">ÂÜíÈô∫„ÇíÂßã„ÇÅ„Çã</button>
        </div>
        
        <div id="story">
            <p id="story-text"></p>
            <div id="choices"></div>
            <button id="restart-button">„ÇÇ„ÅÜ‰∏ÄÂ∫¶Âßã„ÇÅ„Çã</button>
        </div>
    </div>

    <script>
        // Áâ©Ë™û„ÅÆ„Ç∑„Éä„É™„Ç™„Éá„Éº„Çø
        const story = {
            start: {
                text: "„ÅÇ„Å™„Åü„ÅØÈùô„Åã„Å™Â§úÈÅì„ÇíÊ≠©„ÅÑ„Å¶„ÅÑ„Åü„ÄÇÁ™ÅÁÑ∂„ÄÅÁ©∫„Åã„ÇâÈôç„ÇäÊ≥®„ÅêÊµÅ„ÇåÊòü„ÇíÁõÆ„Å´„Åô„Çã„ÄÇ„Åù„ÅÆ‰∏≠„ÅÆ‰∏Ä„Å§„Åå„ÄÅËøë„Åè„ÅÆÊ£Æ„Å´ËêΩ„Å°„Å¶„ÅÑ„Åè„ÅÆ„ÅåË¶ã„Åà„Åü„ÄÇ",
                choices: [
                    { text: "ÊµÅ„ÇåÊòü„ÅåËêΩ„Å°„ÅüÂ†¥ÊâÄ„ÇíÊé¢„Åó„Å´Ë°å„Åè", next: "forest" },
                    { text: "„Åù„ÅÆ„Åæ„ÅæÂÆ∂„Å´Â∏∞„Çã", next: "home" }
                ],
                background: "night",
                music: "intro"
            },
            forest: {
                text: "Â•ΩÂ•áÂøÉ„Å´ÈßÜ„Çâ„Çå„ÄÅ„ÅÇ„Å™„Åü„ÅØÊ£Æ„Å∏„Å®Ë∂≥„ÇíË∏è„ÅøÂÖ•„Çå„Åü„ÄÇÊöó„ÅÑÂ∞èÈÅì„ÇíÈÄ≤„ÇÄ„Å®„ÄÅÊú®„ÄÖ„ÅÆÈñì„Åã„Çâ‰∏çÊÄùË≠∞„Å™Èùí„ÅÑÂÖâ„ÅåÊºè„Çå„Å¶„ÅÑ„Çã„ÄÇ",
                choices: [
                    { text: "ÂÖâ„ÅÆÊñπ„Å∏Ëøë„Å•„Åè", next: "light" },
                    { text: "Âç±Èô∫„ÇíÊÑü„Åò„ÄÅÂºï„ÅçËøî„Åô", next: "retreat" }
                ],
                background: "forest",
                music: "mystery"
            },
            light: {
                text: "ÂÖâ„Å´Â∞é„Åã„Çå„Çã„Çà„ÅÜ„Å´ÈÄ≤„ÇÄ„Å®„ÄÅÂ∞è„Åï„Å™Á©∫„ÅçÂú∞„Å´Ëæø„ÇäÁùÄ„ÅÑ„Åü„ÄÇ„Åù„Åì„Å´„ÅØ„ÄÅ„Åç„Çâ„ÇÅ„ÅèÈùí„ÅÑÁü≥„ÅåËêΩ„Å°„Å¶„ÅÑ„Åü„ÄÇÊâã„Å´Âèñ„Çã„Å®„ÄÅÁ™ÅÁÑ∂„ÄÅÁü≥„Åã„ÇâÂ£∞„ÅåËÅû„Åì„Åà„Çã„ÄÇ„ÄåÂä©„Åë„Å¶„Åè„Å†„Åï„ÅÑ...ÁßÅ„Åü„Å°„ÅÆÊòü„Å´Êù•„Å¶„Åè„Å†„Åï„ÅÑ„Äç",
                choices: [
                    { text: "„Äå„Å©„ÅÜ„Åô„Çå„Å∞Ë°å„Åë„Çã„ÅÆÔºü„Äç„Å®Âïè„ÅÑ„Åã„Åë„Çã", next: "communication" },
                    { text: "È©ö„ÅÑ„Å¶Áü≥„ÇíËêΩ„Å®„Åô", next: "drop_stone" }
                ],
                background: "glow",
                achievement: "Êé¢Ê§úÂÆ∂: Á•ûÁßò„ÅÆÂÖâ„ÇíË¶ã„Å§„Åë„Åü"
            },
            communication: {
                text: "„Äå„Åù„ÅÆÁü≥„ÇíÊè°„Çä„Åó„ÇÅ„Å¶„ÄÅÂøÉ„ÅÆ‰∏≠„ÅßÈ°ò„Å£„Å¶„Åè„Å†„Åï„ÅÑ„Äç„Å®Â£∞„ÅØË®Ä„Å£„Åü„ÄÇ„ÅÇ„Å™„Åü„ÅØÁü≥„ÇíÂº∑„ÅèÊè°„Çä„Åó„ÇÅ„ÄÅÁõÆ„ÇíÈñâ„Åò„Åü„ÄÇ‰Ωì„ÅåËªΩ„Åè„Å™„Çä„ÄÅÈ¢®„Å´‰πó„Å£„Å¶ÊµÆ„Åã„Çì„Åß„ÅÑ„Åè„Çà„ÅÜ„Å™ÊÑüË¶ö„Å´ÂåÖ„Åæ„Çå„Çã„ÄÇ",
                choices: [
                    { text: "È°ò„ÅÑ„ÇíËæº„ÇÅ„Å¶„ÄÅÁü≥„ÇíÊè°„Çä„Åó„ÇÅ„Çã", next: "teleport" },
                    { text: "ÊúÄÂæå„ÅÆÁû¨Èñì„Å´ÊÄñ„Åè„Å™„Çä„ÄÅ„ÇÑ„ÇÅ„Çã", next: "hesitate" }
                ],
                background: "sparkle"
            },
            teleport: {
                text: "ÁõÆ„ÇíÈñã„Åë„Çã„Å®„ÄÅ„Åù„Åì„ÅØË¶ã„Åü„Åì„Å®„ÇÇ„Å™„ÅÑÈ¢®ÊôØ„Å†„Å£„Åü„ÄÇÁ¥´Ëâ≤„ÅÆÁ©∫„Å´‰∫å„Å§„ÅÆÊúà„ÅåÊµÆ„Åã„Å≥„ÄÅÂë®„Çä„Å´„ÅØÊ∞¥Êô∂„ÅÆ„Çà„ÅÜ„Å™Âª∫Áâ©„ÅåÁ´ã„Å°‰∏¶„Çì„Åß„ÅÑ„Çã„ÄÇ„ÅÇ„Å™„Åü„ÅÆÂâç„Å´„ÅØ„ÄÅÈùí„ÅÑËÇå„Çí„Åó„ÅüÂ≠òÂú®„ÅåÁ´ã„Å£„Å¶„ÅÑ„Åü„ÄÇ„Äå„Çà„ÅèÊù•„Å¶„Åè„Çå„Åæ„Åó„Åü„ÄÅÊóÖ‰∫∫„Çà„ÄÇÊàë„ÄÖ„ÅÆÊòü„ÅØÂç±Ê©ü„Å´ÁÄï„Åó„Å¶„ÅÑ„Åæ„Åô„Äç",
                choices: [
                    { text: "„Äå‰Ωï„Åå„ÅÇ„Å£„Åü„ÅÆÔºü„Äç„Å®Â∞ã„Å≠„Çã", next: "alien_story" },
                    { text: "„ÄåÁßÅ„Å´‰Ωï„Åå„Åß„Åç„Çã„ÅÆÔºü„Äç„Å®Â∞ã„Å≠„Çã", next: "help_request" }
                ],
                background: "alien_world",
                music: "space",
                achievement: "ÊòüÈñìÊóÖË°åËÄÖ: Áï∞‰∏ñÁïå„Å´Âà∞ÈÅî"
            },
            alien_story: {
                text: "„ÄåÊàë„ÄÖ„ÅÆÊòü„ÅÆ„Ç®„Éç„É´„ÇÆ„ÉºÊ∫ê„Åß„ÅÇ„ÇãÁµêÊô∂„Åå„ÄÅÈóá„ÅÆÂäõ„Å´‰æµÈ£ü„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆ„Åæ„Åæ„Åß„ÅØ„ÄÅÊàë„ÄÖ„ÅÆÊñáÊòé„ÅØÊªÖ„Å≥„Å¶„Åó„Åæ„ÅÜ„Äç„Å®Èùí„ÅÑÂ≠òÂú®„ÅØÊÇ≤„Åó„Åí„Å´Ë™û„Å£„Åü„ÄÇ„Äå‰ºùË™¨„Å´„Çà„Çå„Å∞„ÄÅ‰ªñ„ÅÆ‰∏ñÁïå„Åã„Çâ„ÅÆÁ¥îÁ≤ã„Å™ÂøÉ„ÇíÊåÅ„Å§ËÄÖ„Å†„Åë„Åå„ÄÅ„Åì„ÅÆÂç±Ê©ü„ÇíÊïë„Åà„Çã„Å®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„Äç",
                choices: [
                    { text: "„ÄåÁßÅ„Å´„Åß„Åç„Çã„Åì„Å®„Å™„Çâ„ÄÅÂäõ„Å´„Å™„Çä„Åü„ÅÑ„Äç", next: "accept_mission" },
                    { text: "„Äå„Åî„ÇÅ„Çì„ÄÅ„Åì„Çå„ÅØÁßÅ„Å´„ÅØÁÑ°ÁêÜ„Å†„Äç", next: "decline_mission" }
                ],
                background: "crystal"
            },
            accept_mission: {
                text: "„Äå„ÅÇ„Çä„Åå„Å®„ÅÜ„ÄÅÂãáÊï¢„Å™ÊóÖ‰∫∫„Çà„ÄçÈùí„ÅÑÂ≠òÂú®„ÅÆÁõÆ„ÅåÂ∏åÊúõ„Å´Ëºù„Åè„ÄÇ„Äå„Åß„ÅØ„ÄÅ‰∏≠Â§ÆÁ•ûÊÆø„Å´Âêë„Åã„ÅÑ„Åæ„Åó„Çá„ÅÜ„ÄÇ„Åù„Åì„ÅßÁµêÊô∂„ÅÆÊµÑÂåñ„ÅÆÂÑÄÂºè„ÇíË°å„ÅÑ„Åæ„Åô„Äç„ÅÇ„Å™„Åü„ÅØÁï∞‰∏ñÁïå„ÅÆË°ó„ÇíÈÄ≤„Åø„ÄÅÂ£ÆÂ§ß„Å™Á•ûÊÆø„Å´„Åü„Å©„ÇäÁùÄ„ÅÑ„Åü„ÄÇ",
                choices: [
                    { text: "ÂÑÄÂºè„Å´ÂèÇÂä†„Åô„Çã", next: "ritual" },
                    { text: "ÊúÄÂæå„ÅÆÁû¨Èñì„Å´Ëø∑„ÅÑ„ÅåÁîü„Åò„Çã", next: "doubt" }
                ],
                background: "temple",
                music: "epic"
            },
            ritual: {
                text: "Á•ûÊÆø„ÅÆ‰∏≠Â§Æ„Å´„ÅØ„ÄÅ„Åã„Å§„Å¶„ÅØËºù„ÅÑ„Å¶„ÅÑ„Åü„Åß„ÅÇ„Çç„ÅÜÂ∑®Â§ß„Å™ÁµêÊô∂„Åå„ÄÅ‰ªä„ÅØÊöó„ÅèÊõá„Å£„Å¶„ÅÑ„Çã„ÄÇ„Äå‰∏°Êâã„ÇíÁµêÊô∂„Å´ÂΩì„Å¶„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‰∏ñÁïå„ÅÆË®òÊÜ∂„ÇíÊÄù„ÅÑÊµÆ„Åã„Åπ„Å¶„Åè„Å†„Åï„ÅÑ„Äç„Å®„Ç¨„Ç§„Éâ„Åï„Çå„Çã„ÄÇ„ÅÇ„Å™„Åü„ÅØÊ∑±ÂëºÂê∏„Åó„ÄÅÂú∞ÁêÉ„ÅÆÁæé„Åó„ÅÑËá™ÁÑ∂„ÄÅÊÑõ„Åô„Çã‰∫∫„ÄÖ„ÅÆÈ°î„ÇíÊÄù„ÅÑËµ∑„Åì„Åó„Åü„ÄÇ",
                choices: [
                    { text: "ÂÖ®Ë∫´ÂÖ®Èúä„ÅßÁµêÊô∂„Å´ÊÑèË≠ò„ÇíÈõÜ‰∏≠„Åô„Çã", next: "success" },
                    { text: "ÈÄî‰∏≠„ÅßÊÄñ„Åè„Å™„Çä„ÄÅÊâã„ÇíÂºï„Å£Ëæº„ÇÅ„Çã", next: "partial_success" }
                ],
                background: "crystal_ceremony"
            },
            success: {
                text: "„ÅÇ„Å™„Åü„ÅÆÊâã„Åã„ÇâÁµêÊô∂„Å´ÂÖâ„ÅåÂ∫É„Åå„ÇäÂßã„ÇÅ„Åü„ÄÇÊöó„Åã„Å£„ÅüÁµêÊô∂„ÅåÂæê„ÄÖ„Å´Ëºù„Åç„ÇíÂèñ„ÇäÊàª„Åó„ÄÅÁ•ûÊÆøÂÖ®‰Ωì„ÅåÁú©„Åó„ÅÑ„Åª„Å©„ÅÆÂÖâ„Å´ÂåÖ„Åæ„Çå„Çã„ÄÇ„ÄåÊàêÂäü„Åó„Åæ„Åó„ÅüÔºÅ„ÄçÂñú„Å≥„ÅÆÂ£∞„Åå„ÅÇ„Åå„Çã‰∏≠„ÄÅ„ÅÇ„Å™„Åü„ÅØÂäõ„Çí‰Ωø„ÅÑÊûú„Åü„Åó„ÄÅÊÑèË≠ò„ÅåÈÅ†„ÅÆ„ÅÑ„Å¶„ÅÑ„Åè...",
                choices: [
                    { text: "ÁõÆ„ÇíÈñâ„Åò„ÄÅË∫´„ÇíÂßî„Å≠„Çã", next: "return_hero" }
                ],
                background: "bright_light",
                music: "triumph",
                achievement: "Êïë‰∏ñ‰∏ª: Áï∞‰∏ñÁïå„ÇíÊïë„ÅÜ"
            },
            return_hero: {
                text: "ÁõÆ„ÇíË¶ö„Åæ„Åô„Å®„ÄÅ„ÅÇ„Å™„Åü„ÅØÊ£Æ„ÅÆ‰∏≠„Å´Êàª„Å£„Å¶„ÅÑ„Åü„ÄÇÊâã„ÅÆ‰∏≠„Å´„ÅØÂ∞è„Åï„Å™ÂÖâ„ÇãÁµêÊô∂„ÅÆ„Åã„Åë„Çâ„ÅåÊÆã„Åï„Çå„Å¶„ÅÑ„Çã„ÄÇ„Åù„Çå„ÅØÁï∞‰∏ñÁïå„Å®„ÅÆÁπã„Åå„Çä„ÅÆË®º„ÄÇÁ©∫„ÇíË¶ã‰∏ä„Åí„Çã„Å®„ÄÅÊñ∞„Åó„ÅÑÊòü„ÅåËºù„ÅÑ„Å¶„ÅÑ„Çã„Çà„ÅÜ„Å´Ë¶ã„Åà„Åü„ÄÇ„ÅÇ„Å™„Åü„ÅÆÂÜíÈô∫„ÅØ„ÄÅ„Åì„Çå„Åã„Çâ„ÇÇÂøÉ„ÅÆ‰∏≠„ÅßÁ∂ö„ÅÑ„Å¶„ÅÑ„Åè„ÄÇ",
                choices: [
                    { text: "„Åä„Çè„Çä", next: "end" }
                ],
                background: "peaceful_forest",
                music: "ending",
                isEnding: true,
                endingType: "true_ending"
            },
            home: {
                text: "„ÅÇ„Å™„Åü„ÅØÊµÅ„ÇåÊòü„ÇíË¶ãÈÄÅ„Çä„ÄÅÂÆ∂„Å´Â∏∞„Çã„Åì„Å®„Å´„Åó„Åü„ÄÇÂÆ∂„Å´ÁùÄ„Åè„Å®„ÄÅ„ÉÜ„É¨„Éì„ÅÆ„Éã„É•„Éº„Çπ„ÅßËøë„Åè„ÅÆÊ£Æ„Å´‰Ωï„Åã„ÅåËêΩ‰∏ã„Åó„Åü„Å®Â†±„Åò„Å¶„ÅÑ„Åü„ÄÇ„ÄåÊòéÊó•„ÄÅË¶ã„Å´Ë°å„Åì„ÅÜ„Åã„Å™„Äç„Å®ËÄÉ„Åà„Å™„Åå„ÇâÁú†„Çä„Å´„Å§„ÅÑ„Åü„ÄÇ",
                choices: [
                    { text: "Êúù„Å´„Å™„Å£„Åü„ÇâÊ£Æ„Å∏Ë°å„Åè", next: "next_day" },
                    { text: "Âøò„Çå„Å¶ÊôÆÊÆµÈÄö„Çä„ÅÆÁîüÊ¥ª„ÇíÈÄÅ„Çã", next: "normal_life" }
                ],
                background: "home",
                music: "calm"
            },
            // ‰ªñ„ÅÆÂàÜÂ≤ê„Ç∑„Éä„É™„Ç™„ÇÇËøΩÂä†...
            drop_stone: {
                text: "È©ö„ÅÑ„Å¶Áü≥„ÇíËêΩ„Å®„Åô„Å®„ÄÅÈùí„ÅÑÂÖâ„ÅØ‰∏ÄÁû¨ÊøÄ„Åó„ÅèËºù„Åç„ÄÅ„Åù„Åó„Å¶Ê∂à„Åà„Åü„ÄÇ„ÄåÂæÖ„Å£„Å¶...„Äç„Å®„ÅÑ„ÅÜÂ£∞„ÅåÈ¢®„Å´Ê∂à„Åà„Å¶„ÅÑ„Åè„ÄÇ‰Ωï„Åã„Å®„Å¶„ÇÇÈáçË¶Å„Å™„ÇÇ„ÅÆ„ÇíÈÄÉ„Åó„Å¶„Åó„Åæ„Å£„Åü„Çà„ÅÜ„Å™ÂæåÊÇî„ÅåÊÆã„Çã„ÄÇ",
                choices: [
                    { text: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶Áü≥„ÇíÊé¢„Åô", next: "search_again" },
                    { text: "ÂÆ∂„Å´Â∏∞„Çã", next: "go_home_scared" }
                ],
                background: "dim_forest"
            },
            retreat: {
                text: "‰∏çÊ∞óÂë≥„Å™ÂÖâ„Å´Âç±Èô∫„ÇíÊÑü„Åò„ÄÅ„ÅÇ„Å™„Åü„ÅØÊ£Æ„Åã„ÇâÂá∫„Çã„Åì„Å®„Å´„Åó„Åü„ÄÇÂ∏∞„ÇäÈÅì„ÄÅÁ©∫„ÇíË¶ã‰∏ä„Åí„Çã„Å®Êòü„Åå‰∏ÄÁû¨Êòé„Çã„ÅèÁû¨„Åç„ÄÅ„Åù„Åó„Å¶Ê∂à„Åà„Åü„ÄÇ‰Ωï„ÅãÁâπÂà•„Å™„ÇÇ„ÅÆ„ÇíË¶ãÈÄÉ„Åó„Åü„Çà„ÅÜ„Å™ÊÑüË¶ö„ÅåÊÆã„Çã„ÄÇ",
                choices: [
                    { text: "ÂÆ∂„Å´Â∏∞„Çã", next: "missed_chance" },
                    { text: "„ÇÑ„Å£„Å±„ÇäÂºï„ÅçËøî„Åô", next: "return_forest" }
                ],
                background: "night_exit",
                music: "regret"
            },
            normal_life: {
                text: "„ÅÇ„Å™„Åü„ÅØÊó•Â∏∏ÁîüÊ¥ª„Å´Êàª„Çä„ÄÅÊµÅ„ÇåÊòü„ÅÆ„Åì„Å®„ÅØÊ¨°Á¨¨„Å´Âøò„Çå„Å¶„ÅÑ„Å£„Åü„ÄÇÊôÇ„ÄÖ„ÄÅÂ§úÁ©∫„ÇíË¶ã‰∏ä„Åí„Çã„Å®„ÄÅ„Å©„Åì„ÅãÊáê„Åã„Åó„Åï„ÇíÊÑü„Åò„Çã„Åå„ÄÅ„Åù„ÅÆÁêÜÁî±„ÅØÂàÜ„Åã„Çâ„Å™„ÅÑ„ÄÇÂπ≥Á©è„Å™Êó•„ÄÖ„ÅåÁ∂ö„Åè„ÄÇ",
                choices: [
                    { text: "„Åä„Çè„Çä", next: "end" }
                ],
                background: "daily_life",
                isEnding: true,
                endingType: "normal_ending"
            },
            // „Ç§„Éº„Çπ„Çø„Éº„Ç®„ÉÉ„Ç∞ÂàÜÂ≤ê
            search_again: {
                text: "ÊÖéÈáç„Å´Âë®Âõ≤„ÇíÊé¢„Åô„Å®„ÄÅÁü≥„ÅØË¶ã„Å§„Åã„Çâ„Å™„Åã„Å£„Åü„Åå„ÄÅ‰ª£„Çè„Çä„Å´Â∞è„Åï„Å™Èùí„ÅÑËä±„ÅåÁîü„Åà„Å¶„ÅÑ„Çã„ÅÆ„ÇíË¶ã„Å§„Åë„Åü„ÄÇ‰∏çÊÄùË≠∞„Å™„Åì„Å®„Å´„ÄÅ„Åù„ÅÆËä±„ÅØÊ∑°„ÅèÂÖâ„ÇíÊîæ„Å£„Å¶„ÅÑ„Çã„ÄÇ",
                choices: [
                    { text: "Ëä±„ÇíÊëò„ÇÄ", next: "flower_portal" },
                    { text: "Ëä±„Çí„Åù„ÅÆ„Åæ„Åæ„Å´„Åó„Å¶Â∏∞„Çã", next: "leave_flower" }
                ],
                background: "glowing_flower",
                achievement: "Â•ΩÂ•áÂøÉ: Á•ûÁßò„ÅÆËä±„ÇíÁô∫Ë¶ã"
            },
            flower_portal: {
                text: "Ëä±„Å´Ëß¶„Çå„ÅüÁû¨Èñì„ÄÅ„Åæ„Çã„ÅßÈõªÊµÅ„ÅåËµ∞„Å£„Åü„Åã„ÅÆ„Çà„ÅÜ„Å™ÊÑüË¶ö„Åå„ÅÇ„Çä„ÄÅÂë®Âõ≤„ÅÆÈ¢®ÊôØ„ÅåÊ≠™„ÅøÂßã„ÇÅ„Åü„ÄÇÊ∞ó„Åå„Å§„Åè„Å®„ÄÅ„ÅÇ„Å™„Åü„ÅØÊòüÁ©∫„ÅÆ‰∏≠„Å´ÊµÆ„Åã„Çì„Åß„ÅÑ„Çã„ÄÇ„ÄåÂà•„ÅÆÊñπÊ≥ï„ÇíË¶ã„Å§„Åë„Åü„ÅÆ„Å≠„Äç„Å®„ÅÑ„ÅÜÂ£∞„ÅåËÅû„Åì„Åà„Çã„ÄÇ",
                choices: [
                    { text: "„Äå„Åì„Åì„ÅØ„Å©„ÅìÔºü„Äç„Å®Â∞ã„Å≠„Çã", next: "space_between" },
                    { text: "„Éë„Éã„ÉÉ„ÇØ„Å´„Å™„Çã", next: "panic_space" }
                ],
                background: "space_void",
                music: "ethereal",
                achievement: "Áô∫Ë¶ãËÄÖ: Èö†„Åï„Çå„ÅüÈÅì„ÇíË¶ã„Å§„Åë„Åü"
            },
            space_between: {
                text: "„Äå„Åì„Åì„ÅØ‰∏ñÁïå„Å®‰∏ñÁïå„ÅÆÈñì„ÄÇ„ÅÇ„Å™„Åü„ÅØÁâπÂà•„Å™Â≠òÂú®„Å†„Çè„ÄçÈÄèÊòé„Å™Âßø„Çí„Åó„ÅüÂ≠òÂú®„ÅåÁèæ„Çå„Çã„ÄÇ„ÄåÈÅ∏„Å∞„Çå„ÅóËÄÖ„ÅØÂ∞ë„Å™„ÅÑ„ÄÇ„ÅÇ„Å™„Åü„Å´„ÅØÂÆáÂÆô„ÅÆÁßòÂØÜ„ÇíË¶ã„Åõ„Å¶„ÅÇ„Åí„Åæ„Åó„Çá„ÅÜ„Äç",
                choices: [
                    { text: "ÁßòÂØÜ„ÇíÁü•„Çã", next: "cosmic_secret" }
                ],
                background: "cosmic",
                music: "revelation"
            },
            cosmic_secret: {
                text: "Â≠òÂú®„ÅØ„ÅÇ„Å™„Åü„Å´ÂÆáÂÆô„ÅÆÁúüÁêÜ„ÇíË™û„ÇäÂßã„ÇÅ„Åü„ÄÇ„Åô„Åπ„Å¶„ÅÆÊòü„ÄÅ„Åô„Åπ„Å¶„ÅÆ‰∏ñÁïå„ÅåÁπã„Åå„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÄÇ„Åù„Åó„Å¶ÊôÇ„Å´„ÅØ„ÄÅÁâπÂà•„Å™È≠Ç„Åå„Åù„ÅÆÂ¢ÉÁïå„ÇíË∂ä„Åà„Çâ„Çå„Çã„Åì„Å®„ÄÇ„Äå„ÅÇ„Å™„Åü„ÅØ„Åù„ÅÆ‰∏Ä‰∫∫„ÄÇ„Åì„ÅÆÁü•Ë≠ò„ÇíÊåÅ„Å°Â∏∞„Çä„Å™„Åï„ÅÑ„Äç",
                choices: [
                    { text: "ÂïìÁ§∫„ÇíÂèó„ÅëÂÖ•„Çå„Çã", next: "enlightenment" }
                ],
                background: "universe",
                achievement: "ÂïìÁ§∫: ÂÆáÂÆô„ÅÆÁúüÁêÜ„ÇíÁü•„Çã"
            },
            enlightenment: {
                text: "ÁõÆ„ÅåË¶ö„ÇÅ„Çã„Å®„ÄÅ„ÅÇ„Å™„Åü„ÅØÊ£Æ„ÅÆ‰∏≠„Å´„ÅÑ„Åü„ÄÇ„Åó„Åã„Åó„ÄÅ‰∏ñÁïå„ÅÆË¶ã„ÅàÊñπ„ÅåÂ§â„Çè„Å£„Å¶„ÅÑ„Åü„ÄÇÊú®„ÄÖ„ÅÆÈñì„Å´ÂÖâ„ÅÆÁ≥∏„ÅåË¶ã„Åà„ÄÅÂ§úÁ©∫„ÅÆÊòü„ÄÖ„ÅåË™û„Çä„Åã„Åë„Å¶„Åè„Çã„Çà„ÅÜ„ÄÇ„Åì„ÅÆÁâπÂà•„Å™Ë¶ñÁÇπ„ÅØ„ÄÅ„ÅÇ„Å™„Åü„Å†„Åë„ÅÆ„ÇÇ„ÅÆ„ÄÇ",
                choices: [
                    { text: "„Åä„Çè„Çä", next: "end" }
                ],
                background: "enlightened_forest",
                music: "transcendence",
                isEnding: true,
                endingType: "secret_ending",
                achievement: "Ë¶öÈÜíËÄÖ: Èö†„Åï„Çå„Åü„Ç®„É≥„Éá„Ç£„É≥„Ç∞„ÇíÁô∫Ë¶ã"
            },
            end: {
                text: "„ÅÇ„Å™„Åü„ÅÆÁâ©Ë™û„ÅØ„Åì„Åì„ÅßÁµÇ„Çè„Çä„Åæ„Åô„ÄÇ„Åó„Åã„Åó„ÄÅ‰ªñ„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÈÅ∏„Åπ„Å∞„ÄÅÈÅï„ÅÜÁµêÊú´„ÅåÂæÖ„Å£„Å¶„ÅÑ„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„ÄÇ",
                choices: [
                    { text: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶Âßã„ÇÅ„Çã", next: "restart" }
                ],
                background: "stars",
                music: "end"
            }
        };

        // DOMË¶ÅÁ¥†
        const titleScreen = document.getElementById('title-screen');
        const storySection = document.getElementById('story');
        const storyText = document.getElementById('story-text');
        const choicesContainer = document.getElementById('choices');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const shareButton = document.getElementById('share-button');
        const soundToggle = document.getElementById('sound-toggle');
        const backgroundElements = document.getElementById('background-elements');

        // „Ç≤„Éº„É†Áä∂ÊÖã
        let currentScene = 'start';
        let achievements = [];
        let visitedScenes = {};
        let soundEnabled = true;
        let sounds = {};
        let totalScenes = Object.keys(story).length;
        let completedEndings = [];

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÈÄ≤Ë°åÁä∂Ê≥Å„ÇíË™≠„ÅøËæº„ÇÄ
        function loadProgress() {
            const savedProgress = localStorage.getItem('storyProgress');
            if (savedProgress) {
                const data = JSON.parse(savedProgress);
                achievements = data.achievements || [];
                visitedScenes = data.visitedScenes || {};
                completedEndings = data.completedEndings || [];
                
                // ÈÄ≤Ë°åÁä∂Ê≥Å„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
                updateProgressDisplay();
            }
        }

        // ÈÄ≤Ë°åÁä∂Ê≥Å„Çí‰øùÂ≠ò
        function saveProgress() {
            const data = {
                achievements,
                visitedScenes,
                completedEndings
            };
            localStorage.setItem('storyProgress', JSON.stringify(data));
            
            // ÈÄ≤Ë°åÁä∂Ê≥Å„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            updateProgressDisplay();
        }

        // ÈÄ≤Ë°åÁä∂Ê≥ÅË°®Á§∫„ÅÆÊõ¥Êñ∞
        function updateProgressDisplay() {
            const visitedCount = Object.keys(visitedScenes).length;
            const percentage = Math.min((visitedCount / totalScenes) * 100, 100);
            progress.style.width = `${percentage}%`;
        }

        // ÂÆüÁ∏æ„ÇíË°®Á§∫
        function showAchievement(text) {
            if (!achievements.includes(text)) {
                achievements.push(text);
                saveProgress();
                
                const achievementElement = document.createElement('div');
                achievementElement.className = 'achievement';
                achievementElement.textContent = `ÈÅîÊàê: ${text}`;
                document.body.appendChild(achievementElement);
                
                gsap.to(achievementElement, {
                    right: '20px',
                    duration: 0.5,
                    ease: 'power2.out',
                    onComplete: () => {
                        gsap.to(achievementElement, {
                            right: '-300px',
                            delay: 3,
                            duration: 0.5,
                            ease: 'power2.in',
                            onComplete: () => {
                                achievementElement.remove();
                            }
                        });
                    }
                });
            }
        }

        // Èü≥Ê•Ω„Å®ÂäπÊûúÈü≥„ÅÆÂàùÊúüÂåñ
        function initSounds() {
            sounds = {
                intro: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/intro.mp3'],
                    loop: true,
                    volume: 0.7
                }),
                mystery: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/mystery.mp3'],
                    loop: true,
                    volume: 0.7
                }),
                space: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/space.mp3'],
                    loop: true,
                    volume: 0.7
                }),
                epic: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/epic.mp3'],
                    loop: true,
                    volume: 0.7
                }),
                triumph: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/triumph.mp3'],
                    loop: true,
                    volume: 0.8
                }),
                ending: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/ending.mp3'],
                    loop: true,
                    volume: 0.7
                }),
                calm: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/calm.mp3'],
                    loop: true,
                    volume: 0.6
                }),
                regret: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/regret.mp3'],
                    loop: true,
                    volume: 0.6
                }),
                ethereal: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/ethereal.mp3'],
                    loop: true,
                    volume: 0.6
                }),
                revelation: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/revelation.mp3'],
                    loop: true,
                    volume: 0.7
                }),
                transcendence: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/transcendence.mp3'],
                    loop: true,
                    volume: 0.7
                }),
                end: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/end.mp3'],
                    loop: true,
                    volume: 0.7
                }),
                click: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/click.mp3'],
                    volume: 0.5
                }),
                achievement: new Howl({
                    src: ['https://interactive-storytelling.s3.amazonaws.com/achievement.mp3'],
                    volume: 0.7
                })
            };
            
            // ÂÆüÈöõ„ÅÆ„Éï„Ç°„Ç§„É´„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
            // ÂÆüÈöõ„ÅÆ‰ΩøÁî®ÊôÇ„Å´„ÅØÈÅ©Âàá„Å™Èü≥Â£∞„Éï„Ç°„Ç§„É´„Çí„Éõ„Çπ„ÉÜ„Ç£„É≥„Ç∞„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô
            for (let key in sounds) {
                sounds[key]._src = ['data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV'];
            }
        }

        // Èü≥Ê•Ω„ÅÆÂÜçÁîü
        function playMusic(track) {
            if (!soundEnabled) return;
            
            // ÁèæÂú®ÂÜçÁîü‰∏≠„ÅÆÈü≥Ê•Ω„ÇíÂÅúÊ≠¢
            for (let key in sounds) {
                if (sounds[key].playing()) {
                    sounds[key].stop();
                }
            }
            
            // Êñ∞„Åó„ÅÑ„Éà„É©„ÉÉ„ÇØ„ÇíÂÜçÁîü
            if (track && sounds[track]) {
                sounds[track].play();
            }
        }

        // ÂäπÊûúÈü≥„ÅÆÂÜçÁîü
        function playSound(sound) {
            if (!soundEnabled || !sounds[sound]) return;
            sounds[sound].play();
        }

        // ËÉåÊôØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆË®≠ÂÆö
        function setBackground(type) {
            // ËÉåÊôØËâ≤„ÅÆÂ§âÊõ¥
            let bgColor = '';
            switch (type) {
                case 'night':
                    bgColor = '#0f1729';
                    createStars();
                    break;
                case 'forest':
                    bgColor = '#0a2a12';
                    createForestParticles();
                    break;
                case 'glow':
                    bgColor = '#103a4a';
                    createGlowEffect();
                    break;
                case 'sparkle':
                    bgColor = '#1a1a3a';
                    createSparkleEffect();
                    break;
                case 'alien_world':
                    bgColor = '#2a0a3a';
                    createAlienWorldEffect();
                    break;
                case 'crystal':
                    bgColor = '#0a2a3a';
                    createCrystalEffect();
                    break;
                case 'temple':
                    bgColor = '#2a2a4a';
                    createTempleEffect();
                    break;
                case 'crystal_ceremony':
                    bgColor = '#1a0a2a';
                    createCeremonyEffect();
                    break;
                case 'bright_light':
                    bgColor = '#ffffff';
                    createLightBurstEffect();
                    break;
                case 'peaceful_forest':
                    bgColor = '#1a3a2a';
                    createPeacefulForestEffect();
                    break;
                case 'home':
                    bgColor = '#2a2a2a';
                    createHomeEffect();
                    break;
                case 'daily_life':
                    bgColor = '#4a4a5a';
                    createDailyLifeEffect();
                    break;
                case 'dim_forest':
                    bgColor = '#1a2a1a';
                    createDimForestEffect();
                    break;
                case 'night_exit':
                    bgColor = '#0a0a1a';
                    createNightSkyEffect();
                    break;
                case 'glowing_flower':
                    bgColor = '#0a1a2a';
                    createGlowingFlowerEffect();
                    break;
                case 'space_void':
                    bgColor = '#000000';
                    createSpaceVoidEffect();
                    break;
                case 'cosmic':
                    bgColor = '#0a0a2a';
                    createCosmicEffect();
                    break;
                case 'universe':
                    bgColor = '#000000';
                    createUniverseEffect();
                    break;
                case 'enlightened_forest':
                    bgColor = '#1a2a3a';
                    createEnlightenedForestEffect();
                    break;
                case 'stars':
                    bgColor = '#000000';
                    createStarfieldEffect();
                    break;
                default:
                    bgColor = '#2d3142';
                    break;
            }
            
            gsap.to('body', {
                backgroundColor: bgColor,
                duration: 2
            });
        }

        // Êòü„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
        function createStars() {
            clearBackgroundElements();
            
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                const size = Math.random() * 3 + 1;
                const posX = Math.random() * window.innerWidth;
                const posY = Math.random() * window.innerHeight;
                
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${posX}px`;
                star.style.top = `${posY}px`;
                
                backgroundElements.appendChild(star);
                
                gsap.to(star, {
                    opacity: Math.random() * 0.8 + 0.2,
                    duration: 1,
                    delay: Math.random() * 2
                });
                
                // Êòü„ÅÆÊòéÊªÖ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                gsap.to(star, {
                    opacity: 0.2,
                    duration: 1 + Math.random() * 2,
                    repeat: -1,
                    yoyo: true,
                    delay: Math.random() * 3
                });
            }
        }

        // ‰ªñ„ÅÆËÉåÊôØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Èñ¢Êï∞
        function createForestParticles() {
            clearBackgroundElements();
            // Ê£Æ„ÅÆËÉåÊôØ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÂÆüË£Ö
        }

        function createGlowEffect() {
            clearBackgroundElements();
            // ÂÖâ„ÇãÂäπÊûú„ÅÆÂÆüË£Ö
        }

        // ‰ªñ„ÅÆËÉåÊôØÂäπÊûú„ÇÇÂêåÊßò„Å´ÂÆüË£Ö...

        // ËÉåÊôØË¶ÅÁ¥†„ÅÆ„ÇØ„É™„Ç¢
        function clearBackgroundElements() {
            backgroundElements.innerHTML = '';
        }

        // „Ç∑„Çß„Ç¢Ê©üËÉΩ
        function shareStory() {
            const shareText = `„ÄåÊòü„Å∏„ÅÆÊóÖ„Äç„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Çπ„Éà„Éº„É™„Éº„Çí‰ΩìÈ®ì„Åó„Åæ„Åó„ÅüÔºÅ${achievements.length}ÂÄã„ÅÆÂÆüÁ∏æ„ÇíÁç≤ÂæóÔºÅ #„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Çπ„Éà„Éº„É™„Éº`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Êòü„Å∏„ÅÆÊóÖ',
                    text: shareText,
                    url: window.location.href
                }).catch(err => {
                    console.error('ÂÖ±Êúâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', err);
                });
            } else {
                // „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº
                navigator.clipboard.writeText(shareText + '\n' + window.location.href)
                    .then(() => {
                        alert('„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ');
                    })
                    .catch(err => {
                        console.error('„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å∏„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', err);
                    });
            }
        }

        // „Ç≤„Éº„É†„ÅÆÂàùÊúüÂåñ
        function initGame() {
            // Èü≥„ÅÆÂàùÊúüÂåñ
            initSounds();
            
            // ÈÄ≤Ë°åÁä∂Ê≥Å„ÅÆ„É≠„Éº„Éâ
            loadProgress();
            
            // UI„ÅÆË°®Á§∫
            gsap.to(progressBar, { opacity: 1, duration: 1, delay: 0.5 });
            gsap.to(shareButton, { opacity: 1, duration: 1, delay: 0.5 });
            gsap.to(soundToggle, { opacity: 1, duration: 1, delay: 0.5 });
            
            // „Çø„Ç§„Éà„É´ÁîªÈù¢„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            gsap.to('#title-screen h1', {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 0.2
            });
            
            gsap.to('#title-screen p', {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 0.5
            });
            
            gsap.to('#start-button', {
                opacity: 1,
                duration: 1,
                delay: 0.8
            });
            
            // Êòü„ÅÆËÉåÊôØ„Çí‰ΩúÊàê
            createStars();
            
            // „Ç§„É≥„Éà„É≠Èü≥Ê•Ω„ÇíÂÜçÁîü
            playMusic('intro');
        }

        // „Ç∑„Éº„É≥„ÅÆË°®Á§∫
        function showScene(sceneId) {
            // „Ç∑„Éº„É≥„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà
            if (!story[sceneId]) {
                console.error(`Scene not found: ${sceneId}`);
                return;
            }
            
            // ÁèæÂú®„ÅÆ„Ç∑„Éº„É≥„ÇíÊõ¥Êñ∞
            currentScene = sceneId;
            
            // Ë®™Âïè„Åó„Åü„Ç∑„Éº„É≥„ÇíË®òÈå≤
            if (!visitedScenes[sceneId]) {
                visitedScenes[sceneId] = true;
                saveProgress();
            }
            
            const scene = story[sceneId];
            
            // ËÉåÊôØ„ÅÆË®≠ÂÆö
            if (scene.background) {
                setBackground(scene.background);
            }
            
            // Èü≥Ê•Ω„ÅÆÂÜçÁîü
            if (scene.music) {
                playMusic(scene.music);
            }
            
            // ÂÆüÁ∏æ„ÅÆË°®Á§∫
            if (scene.achievement && !achievements.includes(scene.achievement)) {
                playSound('achievement');
                showAchievement(scene.achievement);
            }
            
            // „Ç®„É≥„Éá„Ç£„É≥„Ç∞„ÅÆË®òÈå≤
            if (scene.isEnding && scene.endingType && !completedEndings.includes(scene.endingType)) {
                completedEndings.push(scene.endingType);
                saveProgress();
                showAchievement(`„Ç®„É≥„Éá„Ç£„É≥„Ç∞Ëß£Êîæ: ${scene.endingType === 'true_ending' ? 'Áúü„ÅÆ„Ç®„É≥„Éá„Ç£„É≥„Ç∞' : 
                                scene.endingType === 'normal_ending' ? 'ÈÄöÂ∏∏„Ç®„É≥„Éá„Ç£„É≥„Ç∞' : 'ÁßòÂØÜ„ÅÆ„Ç®„É≥„Éá„Ç£„É≥„Ç∞'}`);
            }
            
            // „ÉÜ„Ç≠„Çπ„Éà„ÅÆË°®Á§∫
            storyText.textContent = scene.text;
            choicesContainer.innerHTML = '';
            
            // ÈÅ∏ÊäûËÇ¢„ÅÆ‰ΩúÊàê
            scene.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice.text;
                
                button.addEventListener('click', () => {
                    playSound('click');
                    
                    if (choice.next === 'restart') {
                        // „Ç≤„Éº„É†„ÅÆ„É™„Çπ„Çø„Éº„Éà
                        showTitleScreen();
                    } else {
                        // Ê¨°„ÅÆ„Ç∑„Éº„É≥„ÇíË°®Á§∫
                        showScene(choice.next);
                    }
                });
                
                choicesContainer.appendChild(button);
            });
            
            // „É™„Çπ„Çø„Éº„Éà„Éú„Çø„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            if (scene.isEnding) {
                restartButton.style.display = 'block';
                gsap.to(restartButton, { opacity: 1, duration: 0.5 });
            } else {
                restartButton.style.display = 'none';
                gsap.to(restartButton, { opacity: 0, duration: 0.5 });
            }
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            gsap.fromTo(storyText, 
                { opacity: 0, y: -10 },
                { opacity: 1, y: 0, duration: 0.5 }
            );
            
            gsap.fromTo(choicesContainer, 
                { opacity: 0, y: 10 },
                { opacity: 1, y: 0, duration: 0.5, delay: 0.3 }
            );
        }

        // „Çø„Ç§„Éà„É´ÁîªÈù¢„ÅÆË°®Á§∫
        function showTitleScreen() {
            titleScreen.style.display = 'block';
            storySection.style.display = 'none';
            
            gsap.to('#title-screen h1', {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 0.2
            });
            
            gsap.to('#title-screen p', {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 0.5
            });
            
            gsap.to('#start-button', {
                opacity: 1,
                duration: 1,
                delay: 0.8
            });
            
            // „Ç§„É≥„Éà„É≠Èü≥Ê•Ω„ÇíÂÜçÁîü
            playMusic('intro');
            
            // Êòü„ÅÆËÉåÊôØ„Çí‰ΩúÊàê
            createStars();
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        startButton.addEventListener('click', () => {
            playSound('click');
            
            titleScreen.style.display = 'none';
            storySection.style.display = 'block';
            
            // „Çπ„Éà„Éº„É™„Éº„ÇíÈñãÂßã
            showScene('start');
        });
        
        restartButton.addEventListener('click', () => {
            playSound('click');
            showTitleScreen();
        });
        
        shareButton.addEventListener('click', () => {
            playSound('click');
            shareStory();
        });
        
        soundToggle.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            soundToggle.textContent = soundEnabled ? 'üîä' : 'üîá';
            
            if (soundEnabled) {
                // ÁèæÂú®„ÅÆ„Ç∑„Éº„É≥„ÅÆÈü≥Ê•Ω„ÇíÂÜçÁîü
                const scene = story[currentScene];
                if (scene && scene.music) {
                    playMusic(scene.music);
                }
            } else {
                // „Åô„Åπ„Å¶„ÅÆÈü≥„ÇíÂÅúÊ≠¢
                for (let key in sounds) {
                    if (sounds[key].playing()) {
                        sounds[key].stop();
                    }
                }
            }
        });
        
        // „Ç≤„Éº„É†„ÅÆÂàùÊúüÂåñ„Å®ÈñãÂßã
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
